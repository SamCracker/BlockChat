{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{\"/cpz\":function(e,t,a){\"use strict\";(function(e){var n=a(\"ln6h\"),o=a.n(n),s=a(\"0iUn\"),r=a(\"sLSF\"),c=a(\"vYYK\"),i=(a(\"tnHP\"),a(\"3s30\")),l=a.n(i),u=a(\"HEbw\"),d=a.n(u),g=a(\"oZBQ\"),h=(a(\"VdHB\"),a(\"Ll9b\"),a(\"iHJ3\")),p=(a(\"00dc\"),a(\"Mv2T\")),f=a.n(p),v=(a(\"c98E\"),function(){function t(a){var n=this;Object(s.a)(this,t),Object(c.a)(this,\"loadInfoFromstorageManager\",(function(){n.balance=n.storageManager.getBalance(),n.name=n.storageManager.getName(),n.avatarUrl=n.storageManager.getAvatarUrl(),n.isJoined=n.storageManager.getJoinedStatus(),n.askForTransactionApproval=n.storageManager.getAskForTransactionApproval()})),Object(c.a)(this,\"setProfile\",(function(e,t,a){n.name=e,n.avatarUrl=t,n.isJoined=a})),Object(c.a)(this,\"updateBalance\",(function(){return o.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.a.awrap(g.a.eth.getBalance(n.walletAccount.getAddress().toString(\"hex\")));case 2:n.balance=e.sent,n.storageManager.setBalance(n.balance),h.a.dispatch({action:f.a.EVENT.ACCOUNT_BALANCE_UPDATED});case 5:case\"end\":return e.stop()}}))})),Object(c.a)(this,\"setAskForTransactionApproval\",(function(e){n.storageManager.setAskForTransactionApproval(e),n.askForTransactionApproval=e})),Object(c.a)(this,\"loadPrivateKey\",(function(){var t=n.storageManager.getPrivateKey();if(t){var a=e.from(t,\"hex\");n.walletAccount=l.a.fromPrivateKey(a),n.updateBalance()}})),Object(c.a)(this,\"storePrivateKey\",(function(t){var a=!1;try{var o=e.from(t,\"hex\");n.walletAccount=l.a.fromPrivateKey(o),n.storageManager.storePrivateKeyAndAddress(t,n.getAddress()),a=!0}catch(s){}return n.updateBalance(),a})),Object(c.a)(this,\"getAddress\",(function(){return n.walletAccount?\"0x\"+n.walletAccount.getAddress().toString(\"hex\"):\"\"})),Object(c.a)(this,\"computeSecret\",(function(e){var t=d.a.createECDH(\"secp256k1\");return t.generateKeys(),t.setPrivateKey(n.getPrivateKeyBuffer()),t.computeSecret(e)})),this.isJoined=!1,this.balance=0,this.name=\"\",this.avatarUrl=\"\",this.storageManager=a,this.loadPrivateKey(),this.loadInfoFromstorageManager()}return Object(r.a)(t,[{key:\"getPublicKeyBuffer\",value:function(){return this.walletAccount.getPublicKey()}},{key:\"getPrivateKeyBuffer\",value:function(){return this.walletAccount.getPrivateKey()}}]),t}());t.a=v}).call(this,a(\"HDXh\").Buffer)},\"9Jkg\":function(e,t,a){e.exports=a(\"oh+g\")},Ll9b:function(e,t,a){\"use strict\";var n=a(\"ln6h\"),o=a.n(n),s=a(\"0iUn\"),r=a(\"vYYK\"),c=a(\"oZBQ\"),i=a(\"iHJ3\"),l=a(\"Mv2T\"),u=a.n(l),d=a(\"VdHB\"),g=a.n(d);t.a=function e(t,a,n){var l=this;Object(s.a)(this,e),Object(r.a)(this,\"pullContactEvents\",(function(e,t){var a,n,s,r,c,d,h,p;return o.a.async((function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,o.a.awrap(l.contractManager.getPastEvents(\"addContactEvent\",{filter:{from:l.myAddress},fromBlock:t+1,toBlock:e}));case 2:return a=f.sent,l.storageManager.addRequestEvents(a),f.next=6,o.a.awrap(l.contractManager.getPastEvents(\"addContactEvent\",{filter:{to:l.myAddress},fromBlock:t+1,toBlock:e}));case 6:n=f.sent,l.storageManager.addInvitationEvents(n),s=0;case 9:if(!(s<a.length)){f.next=15;break}return f.next=12,o.a.awrap(l.contractManager.getMemberInfo(a[s].returnValues.to,u.a.Relationship.Requested));case 12:s++,f.next=9;break;case 15:s=0;case 16:if(!(s<n.length)){f.next=22;break}return f.next=19,o.a.awrap(l.contractManager.getMemberInfo(n[s].returnValues.from,u.a.Relationship.NoRelation));case 19:s++,f.next=16;break;case 22:return f.next=24,o.a.awrap(l.contractManager.getPastEvents(\"acceptContactEvent\",{filter:{from:l.myAddress},fromBlock:t+1,toBlock:e}));case 24:return r=f.sent,l.storageManager.addMyAcceptContactEvents(r),f.next=28,o.a.awrap(l.contractManager.getPastEvents(\"acceptContactEvent\",{filter:{to:l.myAddress},fromBlock:t+1,toBlock:e}));case 28:c=f.sent,l.storageManager.addAcceptContactEvents(c),s=0;case 31:if(!(s<c.length)){f.next=39;break}if(d=c[s].returnValues.from,l.storageManager.contacts[d].publicKey){f.next=36;break}return f.next=36,o.a.awrap(l.contractManager.getMemberInfo(d,u.a.Relationship.Connected));case 36:s++,f.next=31;break;case 39:return f.next=41,o.a.awrap(l.contractManager.getPastEvents(\"profileUpdateEvent\",{filter:{from:l.storageManager.contactAddresses},fromBlock:t+1,toBlock:e}));case 41:for(h=f.sent,s=0;s<h.length;s++)p=h[s].returnValues,l.storageManager.updateContact(p.from,\"\",g.a.hexStringToAsciiString(p.name),g.a.hexStringToAsciiString(p.avatarUrl),0);(a.length>0||n.length>0||h.length>0||r.length>0||c.length>0)&&i.a.dispatch({action:u.a.EVENT.CONTACT_LIST_UPDATED});case 44:case\"end\":return f.stop()}}))})),Object(r.a)(this,\"pullMessageEvents\",(function(e,t){var a,n,s,r;return o.a.async((function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,o.a.awrap(l.contractManager.getPastEvents(\"messageSentEvent\",{filter:{from:l.myAddress},fromBlock:t+1,toBlock:e}));case 2:return a=c.sent,c.next=5,o.a.awrap(l.contractManager.getPastEvents(\"messageSentEvent\",{filter:{to:l.myAddress},fromBlock:t+1,toBlock:e}));case 5:for(n=c.sent,s=0,r=0;s<a.length||r<n.length;)s>=a.length?(l.storageManager.addMessageFromFriendEvent(n[r]),r++):r>=n.length?(l.storageManager.addMyMessageEvent(a[s]),s++):a[s].blockNumber<n[r].blockNumber?(l.storageManager.addMyMessageEvent(a[s]),s++):(l.storageManager.addMessageFromFriendEvent(n[r]),r++);(n.length>0||a.length>0)&&i.a.dispatch({action:u.a.EVENT.MESSAGES_UPDATED});case 10:case\"end\":return c.stop()}}))})),Object(r.a)(this,\"pullEvents\",(function(){var e,t;return o.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,e=l.storageManager.getCurrentDataBlock(),a.next=4,o.a.awrap(c.a.eth.getBlockNumber());case 4:if(!((t=a.sent)>e)){a.next=11;break}return a.next=8,o.a.awrap(l.pullContactEvents(t,e));case 8:return a.next=10,o.a.awrap(l.pullMessageEvents(t,e));case 10:l.storageManager.setCurrentDataBlock(t);case 11:a.next=16;break;case 13:a.prev=13,a.t0=a.catch(0),console.log(a.t0.message);case 16:setTimeout(l.pullEvents,5e3);case 17:case\"end\":return a.stop()}}),null,null,[[0,13]])})),Object(r.a)(this,\"start\",(function(){l.pullEvents()})),this.myAddress=t,this.contractManager=a,this.storageManager=n}},RNiq:function(e,t,a){\"use strict\";a.r(t);var n=a(\"0iUn\"),o=a(\"sLSF\"),s=a(\"MI3g\"),r=a(\"a7VT\"),c=a(\"AT/M\"),i=a(\"Tit0\"),l=a(\"q1tI\"),u=a.n(l),d=a(\"FvIY\"),g=a(\"xGDZ\"),h=a(\"oZBQ\"),p=a(\"vYYK\"),f=a(\"iHJ3\"),v=a(\"Mv2T\"),m=a.n(v),b=u.a.createElement,O=function(e){function t(e){var a;return Object(n.a)(this,t),a=Object(s.a)(this,Object(r.a)(t).call(this,e)),Object(p.a)(Object(c.a)(a),\"handleClose\",(function(e){e.preventDefault(),a.setState({errorMessage:\"\"}),a.setState({modalOpen:!1})})),Object(p.a)(Object(c.a)(a),\"handleConfirm\",(function(e){e.preventDefault(),a.setState({errorMessage:\"\"}),a.account.storePrivateKey(a.state.key)?(a.setState({modalOpen:!1}),window.location.reload()):a.setState({errorMessage:\"Invalid private key\"})})),a.state={modalOpen:!1,key:\"\",errorMessage:\"\"},a.account=e.account,a}return Object(i.a)(t,e),Object(o.a)(t,[{key:\"componentDidMount\",value:function(){var e=this;f.a.register((function(t){t.action==m.a.ACTION.OPEN_PRIVATE_KEY_MODAL&&e.setState({modalOpen:!0})}))}},{key:\"render\",value:function(){var e=this;return b(d.q,{open:this.state.modalOpen,onClose:this.handleClose,size:\"small\"},b(d.h,{icon:\"\",content:\"Import private key\"}),b(d.q.Content,null,b(d.k,{fluid:!0,value:this.state.key,onChange:function(t){return e.setState({key:t.target.value})},placeholder:\"Ethereum private key\"}),b(d.p,{error:!0,header:this.state.errorMessage,hidden:\"\"==this.state.errorMessage}),b(\"p\",{style:{marginTop:20}},\"By clicking Confirm, you also agree to our \",b(\"a\",{href:\"/terms\",target:\"_blank\"},\"Terms of use\"))),b(d.q.Actions,null,b(d.a,{color:\"blue\",onClick:this.handleConfirm},b(d.i,{name:\"checkmark\"}),\" Confirm\"),b(d.a,{color:\"grey\",onClick:this.handleClose},b(d.i,{name:\"close\"}),\" Close\")))}}]),t}(l.Component),w=u.a.createElement,k=function(e){function t(e){var a;return Object(n.a)(this,t),a=Object(s.a)(this,Object(r.a)(t).call(this,e)),Object(p.a)(Object(c.a)(a),\"handleClose\",(function(e){e.preventDefault(),a.setState({modalOpen:!1})})),Object(p.a)(Object(c.a)(a),\"updateProfileClicked\",(function(e){e.preventDefault(),a.contractManager.updateProfile(a.state.name,a.state.avatarUrl,(function(e){e==m.a.EVENT.ON_RECEIPT&&window.location.reload()})),a.setState({modalOpen:!1})})),a.account=e.account,a.contractManager=e.contractManager,a.state={modalOpen:!1,name:a.account.name,avatarUrl:a.account.avatarUrl},a}return Object(i.a)(t,e),Object(o.a)(t,[{key:\"componentDidMount\",value:function(){var e=this;f.a.register((function(t){t.action==m.a.ACTION.OPEN_UPDATE_PROFILE?e.setState({modalOpen:!0}):t.action==m.a.EVENT.ACCOUNT_INFO_UPDATED&&e.setState({name:t.profile.name,avatarUrl:t.profile.avatarUrl})}))}},{key:\"render\",value:function(){var e=this;return w(d.q,{open:this.state.modalOpen,onClose:this.handleClose},w(d.h,{icon:\"\",content:\"Update name and avatar\"}),w(d.q.Content,null,w(d.f,null,w(d.f.Field,null,w(\"label\",null,\"Name\"),w(\"input\",{placeholder:\"Maximum 32 characters\",value:this.state.name,onChange:function(t){t.target.value.length<=32&&e.setState({name:t.target.value})}})),w(d.f.Field,null,w(\"label\",null,\"Avatar URL\"),w(\"input\",{placeholder:\"Maximum 32 characters\",value:this.state.avatarUrl,onChange:function(t){t.target.value.length<=32&&e.setState({avatarUrl:t.target.value})}}),w(\"label\",null,\"If your avatar URL is longer than 32 characters, please consider using \",w(\"a\",{href:\"https://goo.gl/\",target:\"_blank\"},\"Google URL Shortener\"))))),w(d.q.Actions,null,w(d.a,{color:\"orange\",onClick:this.updateProfileClicked},\"Update\"),w(d.a,{color:\"grey\",onClick:this.handleClose},\"Close\")))}}]),t}(l.Component),C=a(\"zNWp\"),A=a(\"8Kt/\"),y=a.n(A),S=a(\"ln6h\"),E=a.n(S),M=a(\"/cpz\"),j=a(\"6BQ9\"),T=a.n(j),N=a(\"9Jkg\"),I=a.n(N),D=a(\"VdHB\"),_=a.n(D),P=function(){function e(){var t=this;Object(n.a)(this,e),Object(p.a)(this,\"loadLocalContactAddresses\",(function(){if(t.contactAddresses=[],\"undefined\"!=typeof Storage){var e=window.localStorage.contactAddresses;void 0!=e&&(t.contactAddresses=JSON.parse(e))}})),Object(p.a)(this,\"loadContactMessages\",(function(){if(\"undefined\"!=typeof Storage)for(var e=0;e<t.contactAddresses.length;e++){var a=t.contactAddresses[e],n=window.localStorage[a];t.contacts[a]=JSON.parse(n)}})),Object(p.a)(this,\"addContact\",(function(e,a){if(void 0==t.contacts[e]){var n={messages:[]};n.relationship=a,window.localStorage.setItem(e,I()(n)),t.contacts[e]=n,t.contactAddresses.push(e),window.localStorage.setItem(\"contactAddresses\",I()(t.contactAddresses))}})),Object(p.a)(this,\"updateContact\",(function(e,a,n,o,s){var r=t.contacts[e];void 0!=r&&(r.relationship<s&&(r.relationship=s),a&&(r.publicKey=a),n&&(r.name=n),o&&(r.avatarUrl=o),window.localStorage.setItem(e,I()(r)))})),Object(p.a)(this,\"addInvitationEvents\",(function(e){for(var a=0;a<e.length;a++)t.addContact(e[a].returnValues.from,m.a.Relationship.NoRelation)})),Object(p.a)(this,\"addRequestEvents\",(function(e){for(var a=0;a<e.length;a++)t.addContact(e[a].returnValues.to,m.a.Relationship.Requested)})),Object(p.a)(this,\"addMyAcceptContactEvents\",(function(e){for(var a=0;a<e.length;a++)t.updateContact(e[a].returnValues.to,\"\",\"\",\"\",m.a.Relationship.Connected)})),Object(p.a)(this,\"addAcceptContactEvents\",(function(e){for(var a=0;a<e.length;a++)t.updateContact(e[a].returnValues.from,\"\",\"\",\"\",m.a.Relationship.Connected)})),Object(p.a)(this,\"addMessageFromFriendEvent\",(function(e){var a=e.returnValues,n=a.from,o={isMine:!1};o.message=a.message,o.encryption=_.a.hexStringToAsciiString(a.encryption),o.txHash=e.transactionHash,t.contacts[n].messages.push(o),window.localStorage.setItem(n,I()(t.contacts[n]))})),Object(p.a)(this,\"addMyMessageEvent\",(function(e){for(var a=e.returnValues,n=t.contacts[a.to],o=!0,s=n.messages.length-1;s>=0;s--)e.transactionHash==n.messages[s].txHash&&(n.messages[s].status=m.a.SENT_STATUS.SUCCESS,window.localStorage.setItem(a.to,I()(t.contacts[a.to])),o=!1);if(o){var r={isMine:!0};r.message=a.message,r.encryption=_.a.hexStringToAsciiString(a.encryption),r.txHash=e.transactionHash,n.messages.push(r),window.localStorage.setItem(a.to,I()(t.contacts[a.to]))}})),Object(p.a)(this,\"addMyLocalMessage\",(function(e,a,n,o){(e={message:e,encryption:n,txHash:o}).status=m.a.SENT_STATUS.PENDING,e.isMine=!0,t.contacts[a].messages.push(e),window.localStorage.setItem(a,I()(t.contacts[a]))})),Object(p.a)(this,\"updateLocalMessage\",(function(e,a,n){for(var o=t.contacts[e],s=o.messages.length-1;s>=0;s--)a==o.messages[s].txHash&&(o.messages[s].status=n,window.localStorage.setItem(e,I()(t.contacts[e])))})),Object(p.a)(this,\"clearMessages\",(function(e){window.localStorage.setItem(\"currentDataBlock\",\"0\"),window.localStorage.removeItem(\"contactAddresses\");for(var t=0;t<e.length;t++)window.localStorage.removeItem(e[t])}))}return Object(o.a)(e,[{key:\"initialize\",value:function(){this.contacts={},this.loadLocalContactAddresses(),this.loadContactMessages(),f.a.dispatch({action:m.a.EVENT.CONTACT_LIST_UPDATED})}},{key:\"storePrivateKeyAndAddress\",value:function(e,t){\"undefined\"!==typeof Storage&&(window.localStorage.setItem(\"privateKey\",e),window.localStorage.setItem(\"address\",t),window.localStorage.setItem(\"currentDataBlock\",\"0\"),window.localStorage.setItem(\"ethNetwork\",\"4\"))}},{key:\"getPrivateKey\",value:function(){if(\"undefined\"!==typeof Storage)return window.localStorage.privateKey}},{key:\"getAddress\",value:function(){if(\"undefined\"!==typeof Storage)return window.localStorage.address}},{key:\"setBalance\",value:function(e){\"undefined\"!==typeof Storage&&window.localStorage.setItem(\"balance\",e)}},{key:\"getBalance\",value:function(){return\"undefined\"!==typeof Storage&&void 0!=window.localStorage.balance?window.localStorage.balance:\"0\"}},{key:\"setName\",value:function(e){\"undefined\"!==typeof Storage&&\"\"!=e&&window.localStorage.setItem(\"name\",e)}},{key:\"getName\",value:function(){return\"undefined\"!==typeof Storage&&void 0!=window.localStorage.name?window.localStorage.name:\"\"}},{key:\"setAvatarUrl\",value:function(e){\"undefined\"!==typeof Storage&&e&&window.localStorage.setItem(\"avatarUrl\",e)}},{key:\"getAvatarUrl\",value:function(){return\"undefined\"!==typeof Storage&&void 0!=window.localStorage.avatarUrl?window.localStorage.avatarUrl:\"\"}},{key:\"setJoinedStatus\",value:function(e){\"undefined\"!==typeof Storage&&window.localStorage.setItem(\"isJoined\",e)}},{key:\"getJoinedStatus\",value:function(){return\"undefined\"!==typeof Storage&&void 0!=window.localStorage.isJoined&&window.localStorage.isJoined}},{key:\"getCurrentDataBlock\",value:function(){return T()(window.localStorage.currentDataBlock)}},{key:\"setCurrentDataBlock\",value:function(e){window.localStorage.setItem(\"currentDataBlock\",e)}},{key:\"setAskForTransactionApproval\",value:function(e){\"undefined\"!==typeof Storage&&window.localStorage.setItem(\"askForTransactionApproval\",e)}},{key:\"getAskForTransactionApproval\",value:function(){return!(\"undefined\"===typeof Storage||!window.localStorage.askForTransactionApproval)&&\"true\"==window.localStorage.askForTransactionApproval}},{key:\"removeNetworkDependentData\",value:function(){if(\"undefined\"!==typeof Storage){var e=window.localStorage.contactAddresses;if(void 0!=e){for(var t=JSON.parse(e),a=0;a<t.length;a++)window.localStorage.removeItem(t[a]);window.localStorage.removeItem(\"contactAddresses\")}window.localStorage.removeItem(\"balance\"),window.localStorage.removeItem(\"isJoined\"),window.localStorage.removeItem(\"name\"),window.localStorage.removeItem(\"avatarUrl\"),window.localStorage.setItem(\"currentDataBlock\",\"0\")}}}]),e}(),R=a(\"8dvE\"),x=a(\"Ll9b\"),U=function(){function e(){var t=this;Object(n.a)(this,e),Object(p.a)(this,\"getProfileFromContract\",(function(){var e;return E.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,E.a.awrap(t.contractManager.getProfile());case 2:e=a.sent,t.account.setProfile(e.name,e.avatarUrl,e.isJoined);case 4:case\"end\":return a.stop()}}))})),Object(p.a)(this,\"startEventHandler\",(function(e){t.eventHandler=new x.a(e,t.contractManager,t.storageManager),t.eventHandler.start()}))}return Object(o.a)(e,[{key:\"initialize\",value:function(){var e=this;this.storageManager=new P,this.storageManager.initialize(),this.account=new M.a(this.storageManager),this.contractManager=new R.a(this.account,this.storageManager),f.a.register((function(t){t.action==m.a.EVENT.CONTRACT_READY&&(e.account.getAddress()&&(e.startEventHandler(),e.getProfileFromContract()))}))}},{key:\"getTransactionDispatcher\",value:function(){if(this.contractManager)return this.contractManager.transactionManager.dispatcher}}]),e}(),B=a(\"c98E\"),F=a.n(B),V=u.a.createElement,H=function(e){function t(e){var a;return Object(n.a)(this,t),a=Object(s.a)(this,Object(r.a)(t).call(this,e)),Object(p.a)(Object(c.a)(a),\"handleClose\",(function(e){e.preventDefault(),a.setState({errorMessage:\"\"}),a.setState({modalOpen:!1})})),Object(p.a)(Object(c.a)(a),\"handleAddContact\",(function(e){h.a.utils.isAddress(a.state.address)?(a.contractManager.addContact(a.state.address),a.setState({errorMessage:\"\",modalOpen:!1})):a.setState({errorMessage:\"Invalid ethereum address\"})})),a.state={modalOpen:!1,errorMessage:\"\",address:\"\"},a.contractManager=e.contractManager,a}return Object(i.a)(t,e),Object(o.a)(t,[{key:\"componentDidMount\",value:function(){var e=this;f.a.register((function(t){t.action==m.a.ACTION.ADD_CONTACT&&e.setState({modalOpen:!0,errorMessage:\"\",isLoading:!1,address:\"\"})}))}},{key:\"render\",value:function(){var e=this;return V(d.q,{open:this.state.modalOpen,onClose:this.handleClose,size:\"small\"},V(d.h,{icon:\"\",content:\"Add contact by address\"}),V(d.q.Content,null,V(d.k,{fluid:!0,value:this.state.address,onChange:function(t){return e.setState({address:t.target.value})}}),V(d.p,{error:!0,header:this.state.errorMessage,hidden:\"\"==this.state.errorMessage})),V(d.q.Actions,null,V(d.a,{color:\"orange\",onClick:this.handleAddContact},V(d.i,{name:\"checkmark\"}),\" Add\"),V(d.a,{color:\"grey\",onClick:this.handleClose},V(d.i,{name:\"close\"}),\" Close\")))}}]),t}(l.Component),K=u.a.createElement,q=function(e){function t(e){var a;return Object(n.a)(this,t),a=Object(s.a)(this,Object(r.a)(t).call(this,e)),Object(p.a)(Object(c.a)(a),\"addContactClicked\",(function(){a.account.isJoined?f.a.dispatch({action:m.a.ACTION.ADD_CONTACT}):f.a.dispatch({action:m.a.EVENT.ENCOUNTERED_ERROR,message:\"Please join \"+m.a.APP_NAME+\" first by click on the 'Join' button on the top-right corner\"})})),Object(p.a)(Object(c.a)(a),\"acceptContactRequest\",(function(e){if(a.account.isJoined){var t=e.target.value;a.account.storageManager.contacts[t].isAccepting=!0,a.forceUpdate(),a.contractManager.acceptContactRequest(t,(function(e){e==m.a.EVENT.ON_REJECTED?(a.account.storageManager.contacts[t].isAccepting=!1,a.forceUpdate()):e==m.a.EVENT.ON_ERROR?(a.account.storageManager.contacts[t].isAccepting=!1,a.forceUpdate()):e==m.a.EVENT.ON_RECEIPT&&(a.account.storageManager.contacts[t].isAccepting=!1,a.account.storageManager.contacts[t].relationship=m.a.Relationship.Connected,a.setState({contactAddresses:a.account.storageManager.contactAddresses}))}))}else f.a.dispatch({action:m.a.EVENT.ENCOUNTERED_ERROR,message:\"Please join \"+m.a.APP_NAME+\" first by click on the 'Join' button on the top-right corner\"})})),Object(p.a)(Object(c.a)(a),\"listItemClicked\",(function(e,t){a.account.storageManager.contacts[e].relationship==m.a.Relationship.Connected&&a.account.storageManager.contacts[e].publicKey&&(f.a.dispatch({action:m.a.ACTION.SELECT_CONTACT,data:e}),a.setState({selectedAddress:e}))})),a.account=e.account,a.contractManager=e.contractManager,a.state={contactAddresses:[],isAccepting:[],selectedAddress:\"\"},a}return Object(i.a)(t,e),Object(o.a)(t,[{key:\"componentDidMount\",value:function(){var e=this;this.setState({contactAddresses:this.account.storageManager.contactAddresses}),f.a.register((function(t){t.action==m.a.EVENT.CONTACT_LIST_UPDATED&&e.setState({contactAddresses:e.account.storageManager.contactAddresses})}))}},{key:\"render\",value:function(){var e,t=this.state.contactAddresses,a=this.props.height,n=[];if(void 0==t)e=K(\"div\",null);else if(0==t.length)n.push(K(d.m.Item,{key:\"contact_\"+o},K(d.m.Content,null,K(d.m.Header,null,\"Empty\")))),e=K(d.m,{selection:!0,verticalAlign:\"middle\"},n);else{for(var o=0;o<t.length;o++){var s,r=this.account.storageManager.contacts[t[o]],c=F.a.ENV.ExplorerUrl+\"address/\"+t[o];s=r.relationship==m.a.Relationship.NoRelation?K(d.m.Content,{floated:\"right\"},K(d.a,{color:\"orange\",loading:r.isAccepting,disabled:r.isAccepting,onClick:this.acceptContactRequest,value:t[o]},\"Accept\"),K(d.r,{key:\"info_button_popup_\"+o,trigger:K(d.a,{color:\"green\",as:\"a\",href:c,target:\"_blank\",circular:!0,icon:\"info circle\"}),content:\"View on Etherscan\"})):r.relationship==m.a.Relationship.Requested?K(d.m.Content,{floated:\"right\"},K(d.r,{key:\"wait_popup_\"+o,trigger:K(d.a,{color:\"yellow\",circular:!0,icon:\"wait\"}),content:\"Pending acceptance\"}),K(d.r,{key:\"info_button_popup_\"+o,trigger:K(d.a,{color:\"green\",as:\"a\",href:c,target:\"_blank\",circular:!0,icon:\"info circle\"}),content:\"View on Etherscan\"})):K(d.m.Content,{floated:\"right\"},K(d.r,{key:\"info_button_popup_\"+o,trigger:K(d.a,{color:\"green\",as:\"a\",href:c,target:\"_blank\",circular:!0,icon:\"info circle\"}),content:\"View on Etherscan\"}));var i=t[o];n.push(K(d.m.Item,{active:i==this.state.selectedAddress,key:\"contact_\"+o,value:i,onClick:this.listItemClicked.bind(this,i)},K(d.j,{avatar:!0,src:r.avatarUrl?r.avatarUrl:\"static/images/user.png\"}),K(d.m.Content,null,K(d.m.Header,null,r.name?r.name:i.substr(0,10)),i.substr(0,14)+\"...\"),s))}e=K(d.m,{selection:!0,verticalAlign:\"middle\"},n)}return K(\"div\",{style:{width:\"100%\"}},K(\"div\",{style:{height:40,width:\"100%\"}},K(d.h,{as:\"h2\",style:{float:\"left\"}},\"Contact list\"),K(d.a,{color:\"blue\",style:{float:\"right\"},onClick:this.addContactClicked},K(d.i,{name:\"add user\"}),\"Add\")),K(\"div\",{style:{height:a-40,overflow:\"auto\",float:\"left\",width:\"100%\"}},e),K(H,{contractManager:this.contractManager}))}}]),t}(l.Component),J=a(\"lRu3\"),L=u.a.createElement,z=function(e){function t(){var e,a;Object(n.a)(this,t);for(var o=arguments.length,i=new Array(o),l=0;l<o;l++)i[l]=arguments[l];return a=Object(s.a)(this,(e=Object(r.a)(t)).call.apply(e,[this].concat(i))),Object(p.a)(Object(c.a)(a),\"state\",{modalOpen:!1,message:\"\",title:\"\"}),Object(p.a)(Object(c.a)(a),\"handleClose\",(function(e){e.preventDefault(),a.setState({modalOpen:!1})})),a}return Object(i.a)(t,e),Object(o.a)(t,[{key:\"componentDidMount\",value:function(){var e=this;f.a.register((function(t){t.action==m.a.EVENT.ENCOUNTERED_ERROR&&e.setState({modalOpen:!0,message:t.message,title:t.title})}))}},{key:\"render\",value:function(){return L(d.q,{open:this.state.modalOpen,onClose:this.handleClose,size:\"small\"},L(d.h,{icon:\"\",content:this.state.title?this.state.title:\"Notice\"}),L(d.q.Content,null,L(d.p,{error:!0},this.state.message)),L(d.q.Actions,null,L(d.a,{color:\"grey\",onClick:this.handleClose},\"Close\")))}}]),t}(l.Component),G=u.a.createElement,W=function(e){function t(e){var a;return Object(n.a)(this,t),a=Object(s.a)(this,Object(r.a)(t).call(this,e)),Object(p.a)(Object(c.a)(a),\"handleClose\",(function(e){e.preventDefault(),a.setState({modalOpen:!1})})),Object(p.a)(Object(c.a)(a),\"handleUpdate\",(function(){a.account.setAskForTransactionApproval(a.state.askForApproval),a.setState({modalOpen:!1})})),a.account=e.account,a.state={modalOpen:!1,askForApproval:!1},a}return Object(i.a)(t,e),Object(o.a)(t,[{key:\"componentDidMount\",value:function(){var e=this;f.a.register((function(t){if(t.action==m.a.ACTION.OPEN_SETTINGS_MODAL){var a=e.account.askForTransactionApproval;e.setState({modalOpen:!0,askForApproval:a})}}))}},{key:\"render\",value:function(){var e=this;return G(d.q,{open:this.state.modalOpen,onClose:this.handleClose,size:\"small\"},G(d.h,{icon:\"\",content:\"Settings\"}),G(d.q.Content,null,G(d.b,{toggle:!0,label:\"Ask for transaction approval\",checked:this.state.askForApproval,onChange:function(t,a){return e.setState({askForApproval:a.checked})}})),G(d.q.Actions,null,G(d.a,{color:\"blue\",onClick:this.handleUpdate},\"Update\"),G(d.a,{color:\"grey\",onClick:this.handleClose},\"Close\")))}}]),t}(l.Component),Y=u.a.createElement,Q=function(e){function t(e){var a;return Object(n.a)(this,t),a=Object(s.a)(this,Object(r.a)(t).call(this,e)),Object(p.a)(Object(c.a)(a),\"handleReject\",(function(e){e.preventDefault(),a.setState({modalOpen:!1}),a.dispatcher.dispatch({action:m.a.ACTION.REJECT_TRANSACTION,transactionId:a.state.transactionId})})),Object(p.a)(Object(c.a)(a),\"handleApprove\",(function(e){e.preventDefault(),a.setState({modalOpen:!1}),a.dispatcher.dispatch({action:m.a.ACTION.APPROVE_TRANSACTION,transactionId:a.state.transactionId,method:a.method,gasPrice:a.state.gasPrice,gasAmount:a.state.estimatedGas})})),Object(p.a)(Object(c.a)(a),\"componentDidMount\",(function(){a.dispatcher.register((function(e){e.action==m.a.ACTION.OPEN_TRANSACTION_MODAL&&(a.method=e.method,a.setState({modalOpen:!0,estimatedGas:0,gasPrice:0,transactionId:e.transactionId}),a.updateInfo())}))})),Object(p.a)(Object(c.a)(a),\"updateInfo\",(function(){var e,t,n;return E.a.async((function(o){for(;;)switch(o.prev=o.next){case 0:return t=\"\",o.prev=1,o.next=4,E.a.awrap(a.method.estimateGas({gas:3e6}));case 4:e=o.sent,o.next=11;break;case 7:o.prev=7,o.t0=o.catch(1),e=3e6,o.t0&&(t=o.t0.message);case 11:return o.next=13,E.a.awrap(h.a.eth.getGasPrice());case 13:n=o.sent,a.setState({estimatedGas:e,gasPrice:n,warningMessage:t});case 15:case\"end\":return o.stop()}}),null,null,[[1,7]])})),a.dispatcher=e.dispatcher,a.state={modalOpen:!1,estimatedGas:0,gasPrice:0,transactionId:0,warningMessage:\"\"},a}return Object(i.a)(t,e),Object(o.a)(t,[{key:\"render\",value:function(){var e=this,t=Y(d.d.Dimmable,{as:d.q.Content},Y(d.d,{active:!0,inverted:!0},Y(d.n,{active:!0,inline:\"centered\",inverted:!0})));return this.state.gasPrice&&(t=Y(d.q.Content,null,Y(d.f,{warning:\"\"!=this.state.warningMessage},Y(d.f.Field,null,\"The gas price is suggested by the last few blocks median gas price.\"),Y(d.f.Field,{inline:!0},Y(\"label\",null,\"Gas limit: \"),Y(\"input\",{value:this.state.estimatedGas,disabled:!0})),Y(d.f.Field,{inline:!0},Y(\"label\",null,\"Gas price\"),Y(d.k,{value:h.a.utils.fromWei(this.state.gasPrice,\"gwei\"),label:{basic:!0,content:\"Gwei\"},labelPosition:\"right\",onChange:function(t){t.target.value<1e6&&e.setState({gasPrice:h.a.utils.toWei(t.target.value,\"gwei\")})},style:{textAlign:\"right\"}})),Y(d.f.Field,{inline:!0},Y(\"label\",null,\"Transaction fee: \"),Y(\"label\",null,h.a.utils.fromWei((this.state.estimatedGas*this.state.gasPrice).toString(),\"ether\")+\" ETH\")),Y(d.f.Field,null,Y(d.p,{warning:!0},this.state.warningMessage))))),Y(d.q,{open:this.state.modalOpen,onClose:this.handleClose,size:\"mini\",closeOnDimmerClick:!1},Y(d.h,{icon:\"\",content:\"Confirm transaction\"}),t,Y(d.q.Actions,null,Y(d.a,{color:\"orange\",onClick:this.handleApprove},\"Approve\"),Y(d.a,{color:\"red\",onClick:this.handleReject},\"Reject\")))}}]),t}(l.Component),X=a(\"mGQe\"),Z=u.a.createElement,$=function(e){function t(e){var a;return Object(n.a)(this,t),(a=Object(s.a)(this,Object(r.a)(t).call(this,e))).state={width:0,height:0,contactList:[],messages:[],selectedContact:\"\"},a.updateWindowDimensions=a.updateWindowDimensions.bind(Object(c.a)(a)),a.app=new U,a}return Object(i.a)(t,e),Object(o.a)(t,[{key:\"componentDidMount\",value:function(){this.updateWindowDimensions(),window.addEventListener(\"resize\",this.updateWindowDimensions)}},{key:\"UNSAFE_componentWillMount\",value:function(){this.app.initialize()}},{key:\"componentWillUnmount\",value:function(){window.removeEventListener(\"resize\",this.updateWindowDimensions)}},{key:\"updateWindowDimensions\",value:function(){this.setState({width:window.innerWidth,height:window.innerHeight})}},{key:\"render\",value:function(){var e=this.app.account,t=this.app.contractManager,a=this.app.getTransactionDispatcher(),n=this.state.height-140;return Z(d.c,null,Z(y.a,null,Z(\"title\",null,\"BlockChat - Decentralized messaging on Ethereum network\")),Z(k,{account:e,contractManager:t}),Z(O,{account:e}),Z(g.a,{account:e,transactionDispatcher:a}),Z(C.a,null),Z(z,null),Z(W,{account:e}),Z(Q,{dispatcher:a}),Z(d.g,{column:2,style:{paddingTop:100}},Z(d.g.Row,{stretched:!0},Z(d.g.Column,{width:6,style:{height:n+\"px\",float:\"left\"}},Z(q,{height:n,account:e,contractManager:t})),Z(d.g.Column,{width:10,style:{height:n+\"px\",overflow:\"auto\",float:\"left\"}},Z(J.a,{height:n,account:e,contractManager:t})))),Z(X.a,null))}}]),t}(l.Component);t.default=$},lRu3:function(e,t,a){\"use strict\";(function(e){var n=a(\"0iUn\"),o=a(\"sLSF\"),s=a(\"MI3g\"),r=a(\"a7VT\"),c=a(\"AT/M\"),i=a(\"Tit0\"),l=a(\"vYYK\"),u=a(\"q1tI\"),d=a.n(u),g=a(\"FvIY\"),h=a(\"iHJ3\"),p=a(\"Mv2T\"),f=a.n(p),v=a(\"c98E\"),m=a.n(v),b=a(\"VdHB\"),O=a.n(b),w=d.a.createElement,k=function(t){function a(e){var t;return Object(n.a)(this,a),t=Object(s.a)(this,Object(r.a)(a).call(this,e)),Object(l.a)(Object(c.a)(t),\"sendMessage\",(function(e){t.contractManager.sendMessage(t.state.address,t.account.storageManager.contacts[t.state.address].publicKey,e)})),t.account=e.account,t.contractManager=e.contractManager,t.state={address:\"\",messages:[],publicKey:\"\"},t}return Object(i.a)(a,t),Object(o.a)(a,[{key:\"componentDidMount\",value:function(){this.scrollToBottom()}},{key:\"componentDidUpdate\",value:function(){this.scrollToBottom()}},{key:\"scrollToBottom\",value:function(){void 0!=this.lastObjectAnchor&&this.lastObjectAnchor.scrollIntoView({behavior:\"smooth\"})}},{key:\"componentDidMount\",value:function(){var e=this;h.a.register((function(t){t.action==f.a.ACTION.SELECT_CONTACT?e.setState({address:t.data,publicKey:e.account.storageManager.contacts[t.data].publicKey,messages:e.account.storageManager.contacts[t.data].messages}):\"\"!=e.state.address&&t.action==f.a.EVENT.MESSAGES_UPDATED&&(void 0!=t.data&&t.data!=e.state.address||e.setState({messages:e.account.storageManager.contacts[e.state.address].messages}))}))}},{key:\"render\",value:function(){var t=this,a=this.props.height,n=this.state,o=n.publicKey,s=n.messages,r=[];if(o)if(s.length>0)for(var c=0;c<s.length;c++){var i;i=\"aes256\"==s[c].encryption?O.a.decrypt(s[c].message.substr(2),this.account.computeSecret(e.from(o,\"hex\"))):s[c].message;var l=w(\"span\",null);c==s.length-1&&(l=w(\"span\",{ref:function(e){t.lastObjectAnchor=e}}));var u=m.a.ENV.ExplorerUrl+\"tx/\"+s[c].txHash;s[c].isMine?s[c].status==f.a.SENT_STATUS.PENDING?r.push(w(\"p\",{align:\"right\",key:\"msg_\"+c},w(g.l,{pointing:\"right\",as:\"span\",size:\"large\",color:\"blue\",style:{fontWeight:\"100\",lineHeight:\"1.5\"}},w(g.i,{name:\"circle notched\",loading:!0}),i,l))):s[c].status==f.a.SENT_STATUS.FAILED?r.push(w(\"p\",{align:\"right\",key:\"msg_\"+c},w(g.l,{pointing:\"right\",as:\"span\",key:\"msg_\"+c,size:\"large\",color:\"blue\",style:{fontWeight:\"100\",lineHeight:\"1.5\"}},w(g.i,{name:\"warning sign\"}),i,l))):r.push(w(\"p\",{align:\"right\",key:\"msg_\"+c},w(\"a\",{href:u,target:\"_blank\"},w(g.l,{pointing:\"right\",as:\"span\",key:\"msg_\"+c,size:\"large\",color:\"blue\",style:{fontWeight:\"100\",lineHeight:\"1.5\"}},i,l)))):r.push(w(\"p\",{key:\"msg_\"+c},w(\"a\",{href:u,target:\"_blank\"},w(g.l,{pointing:\"left\",as:\"span\",key:\"msg_\"+c,size:\"large\",style:{fontWeight:\"100\",lineHeight:\"1.5\"}},i,l))))}else r.push(w(g.h,{as:\"h2\",textAlign:\"center\",key:\"no_messages\"},\"No messages\"));return w(\"div\",{style:{width:\"100%\"}},w(g.s,{style:{height:a-90+\"px\",width:\"100%\",overflow:\"auto\"}},r),w(g.s,null,w(C,{disabled:!this.state.address,onSend:this.sendMessage})))}}]),a}(u.Component),C=function(e){function t(e){var a;return Object(n.a)(this,t),(a=Object(s.a)(this,Object(r.a)(t).call(this,e))).state={disabled:e.disabled,content:\"\"},a.onSend=e.onSend,a}return Object(i.a)(t,e),Object(o.a)(t,[{key:\"componentWillReceiveProps\",value:function(e){this.setState({disabled:e.disabled})}},{key:\"sendMessageClicked\",value:function(){this.state.content&&(this.onSend(this.state.content),this.setState({content:\"\"}))}},{key:\"render\",value:function(){var e=this;return w(g.k,{fluid:!0,disabled:this.state.disabled,value:this.state.content,onChange:function(t){return e.setState({content:t.target.value})},action:{color:\"orange\",labelPosition:\"right\",icon:\"send\",content:\"Send\",onClick:function(t){return e.sendMessageClicked()}}})}}]),t}(u.Component);t.a=k}).call(this,a(\"HDXh\").Buffer)},\"oh+g\":function(e,t,a){var n=a(\"WEpk\"),o=n.JSON||(n.JSON={stringify:JSON.stringify});e.exports=function(e){return o.stringify.apply(o,arguments)}},vlRD:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push([\"/\",function(){return a(\"RNiq\")}])}},[[\"vlRD\",1,2,0,3]]]);"}